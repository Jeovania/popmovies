<!DOCTYPE html>
<html lang="pt-BR">
	<head>
		<meta charset="utf-8" />
		<link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="theme-color" content="#37474f" />
		<link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
		<title>Pop Movies - A biblioteca de filmes</title>
	</head>

	<body>
		<noscript> You need to enable JavaScript to run this app. </noscript>
		<div id="root"></div>
		<button class="add-button">Add to home screen</button>
	</body>

	<script>
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', function() {
				navigator.serviceWorker
					.register('service-worker.js')
					.then(
						function(registration) {
							// Registration was successful
							console.log('ServiceWorker registration successful with scope: ', registration.scope)
						},
						function(err) {
							// registration failed :(
							console.log('ServiceWorker registration failed: ', err)
						}
					)
					.catch(function(err) {
						console.log(err)
					})
			})

			let deferredPrompt
			const addBtn = document.querySelector('.add-button')
			addBtn.style.display = 'none'

			window.addEventListener('beforeinstallprompt', e => {
				// Prevent Chrome 67 and earlier from automatically showing the prompt
				e.preventDefault()
				// Stash the event so it can be triggered later.
				deferredPrompt = e
				// Update UI to notify the user they can add to home screen
				addBtn.style.display = 'block'

				addBtn.addEventListener('click', e => {
					// hide our user interface that shows our A2HS button
					addBtn.style.display = 'none'
					// Show the prompt
					deferredPrompt.prompt()
					// Wait for the user to respond to the prompt
					deferredPrompt.userChoice.then(choiceResult => {
						if (choiceResult.outcome === 'accepted') {
							console.log('User accepted the A2HS prompt')
						} else {
							console.log('User dismissed the A2HS prompt')
						}
						deferredPrompt = null
					})
				})
			})
		} else {
			console.log('service worker is not supported')
		}
	</script>
</html>
